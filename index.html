<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eon v2 (Final - India)</title>
    <!-- Using Tailwind CSS for professional styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .app-container { max-width: 420px; margin: 2rem auto; background: white; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); overflow: hidden; border: 4px solid #1f2937; }
        .app-header { background-color: #1f2937; color: white; padding: 1.5rem; text-align: center; }
        .app-header h1 { font-size: 1.75rem; font-weight: 700; }
        .app-header p { font-size: 0.875rem; opacity: 0.8; }
        .app-content { padding: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem; }
        .feature-card { background: #f9fafb; border-radius: 0.75rem; padding: 1rem; border: 1px solid #e5e7eb; }
        .feature-card h2 { font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 0.75rem; }
        .feature-card p { font-size: 0.875rem; color: #4b5563; margin-bottom: 1rem; }
        
        /* Stage 2: Smart Form Styles */
        .form-group { margin-bottom: 0.75rem; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem; }
        .form-input, .form-select { width: 100%; font-size: 0.875rem; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.5rem; background-color: #ffffff; }
        .form-button-add { width: 100%; padding: 0.5rem; background-color: #3b82f6; color: white; font-weight: 600; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: background-color 0.2s; margin-bottom: 1rem; }
        .form-button-add:hover { background-color: #2563eb; }
        .test-queue-list { list-style: none; padding: 0; margin-bottom: 1rem; display: flex; flex-direction: column; gap: 0.5rem; max-height: 150px; overflow-y: auto; }
        .test-queue-item { display: flex; justify-content: space-between; align-items: center; background: #eef2ff; padding: 0.5rem; border-radius: 0.5rem; }
        .test-queue-item span { font-size: 0.875rem; font-family: 'Inter', sans-serif; font-weight: 500; color: #1e3a8a; }
        .test-queue-item button { font-size: 0.75rem; color: #ef4444; font-weight: 600; }
        .test-button-run { width: 100%; padding: 0.75rem; background-color: #16a34a; color: white; font-weight: 600; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: background-color 0.2s; }
        .test-button-run:hover { background-color: #15803d; }
        
        /* Live result styles */
        .live-result-list { list-style: none; padding: 0; margin-top: 1rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .live-result-item { display: flex; align-items: center; justify-content: space-between; background: white; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; }
        .live-result-item .app-name { font-weight: 500; color: #1f2937; }
        .solution-text { font-size: 0.875rem; font-weight: 500; padding: 0.25rem 0.5rem; border-radius: 0.25rem; color: white; text-align: center; }
        .solution-red { background-color: #ef4444; }
        .solution-yellow { background-color: #f59e0b; }
        .solution-green { background-color: #16a34a; }
        .solution-gray { background-color: #6b7280; } 
        
        /* Stage 1: Demo styles */
        .optimize-button { width: 100%; padding: 0.75rem; background-color: #2563eb; color: white; font-weight: 600; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.2s; }
        .optimize-button:hover { background-color: #1d4ed8; }
        .optimize-button.loading { background-color: #9ca3af; cursor: not-allowed; }
        .result-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 0.75rem; }
        .result-item { display: flex; align-items: center; justify-content: space-between; background: white; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; opacity: 0; transform: translateX(-10px); animation: fadeIn 0.3s ease-out forwards; }
        .result-item .app-name { font-weight: 500; color: #1f2937; }
        .result-item .app-reason { font-size: 0.875rem; color: #ef4444; }
        .preload-reason { font-size: 0.875rem; color: #16a34a; }
        .hibernate-reason { font-size: 0.875rem; color: #6b7280; }
        .action-button { padding: 0.25rem 0.5rem; font-size: 0.75rem; font-weight: 500; background-color: #e5e7eb; color: #374151; border-radius: 0.25rem; }
        
        .toggle-btn {
            font-size: 0.75rem;
            color: #2563eb;
            text-decoration: underline;
            cursor: pointer;
            margin-top: 0.5rem;
            display: inline-block;
        }
        
        @keyframes fadeIn { to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div class="app-container">
        
        <header class="app-header">
            <h1>Eon</h1>
            <p>Eco-Optimization Nexus</p>
        </header>

        <main class="app-content">

            <!-- STAGE 2: LIVE MLOps TEST -->
            <section class="feature-card">
                <h2>Stage 2: Live MLOps Test (Verification)</h2>
                <p>Add "live" app data from your device to test our model.</p>
                
                <div id="test-form">
                    <div class="form-group">
                        <label for="app-name-input" class="form-label">App Name (from Colab Top 20)</label>
                        <select id="app-name-input" class="form-select">
                            <option value="com.whatsapp" data-priority="Foreground app">WhatsApp</option>
                            <option value="com.facebook.katana" data-priority="Service">Facebook</option>
                            <option value="com.google.android.youtube" data-priority="Service">YouTube</option>
                            <option value="com.google.android.gm" data-priority="Foreground app">Gmail</option>
                            <option value="com.spotify.music" data-priority="Service">Spotify</option>
                            <option value="com.instagram.android" data-priority="Service">Instagram</option>
                            <option value="com.google.android.calendar" data-priority="Foreground app">Calendar</option>
                            <option value="org.telegram.messenger" data-priority="Foreground app">Telegram</option>
                            <option value="com.snapchat.android" data-priority="Service">Snapchat</option>
                            <option value="com.twitter.android" data-priority="Service">Twitter</option>
                            <option value="com.android.chrome" data-priority="Foreground app">Chrome</option>
                            <option value="com.samsung.android.messaging" data-priority="Foreground app">Samsung Messages</option>
                            <option value="com.google.android.apps.maps" data-priority="Foreground app">Google Maps</option>
                            <option value="com.google.android.googlequicksearchbox" data-priority="Background process">Google Search</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="form-group">
                            <label for="priority-input" class="form-label">Priority</label>
                            <select id="priority-input" class="form-select">
                                <option value="Service">Service</option>
                                <option value="Foreground app">Foreground app</option>
                                <option value="Background process">Background process</option>
                                <option value="unknown">Unknown</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status-input" class="form-label">Battery Status</label>
                            <select id="status-input" class="form-select">
                                <option value="discharging">Discharging</option>
                                <option value="charging">Charging</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="level-input" class="form-label">Battery Level (%)</label>
                        <input type="number" id="level-input" class="form-input" placeholder="e.g., 30" value="75">
                    </div>
                    
                    <div id="add-app-button" class="form-button-add">Add App to Test Queue</div>
                </div>

                <ul id="test-queue-list" class="test-queue-list"></ul>
                
                <div id="test-button-run" class="test-button-run">
                    Run Live Analysis on Queue
                </div>
                
                <ul id="live-results-list" class="live-result-list"></ul>
            </section>
            
            <!-- STAGE 1: STATIC DEMOS -->
            <section class="feature-card">
                <h2>Stage 1: Smart Battery Regulation (Hypothesis)</h2>
                <p>Scan for known battery hogs based on our analysis of the mega_dataset.csv.</p>
                <div id="optimize-button" class="optimize-button">
                    Run Smart Scan
                </div>
                <ul id="hit-list" class="result-list mt-4"></ul>
            </section>

            <section class="feature-card">
                <h2>Stage 1: Intelligent Resource Allocation (Hypothesis)</h2>
                <p id="preload-text">Running analysis...</p>
                <ul id="preload-list" class="result-list"></ul>
            </section>
            
            <section class="feature-card">
                <h2>Stage 1: Adaptive Connectivity (Hypothesis)</h2>
                <p id="connectivity-text">...</p>
                <div id="connectivity-status" class="flex items-center p-3 bg-gray-100 border border-gray-200 rounded-lg">
                    <span class="text-gray-700 font-medium">Status: Monitoring...</span>
                </div>
                <div id="simulate-location" class="toggle-btn">Simulate Location Change (VPN)</div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =========================================================
            // === INTELLIGENCE & DATA (The "Brain") ===
            // =========================================================
            
            const TRAINED_MODEL = {
    "usage_map": {
        "youtube": [
            0,
            3,
            7,
            12,
            13,
            16,
            20,
            22,
            23
        ],
        "instagram": [
            20,
            21,
            22
        ],
        "chrome": [
            7,
            8,
            9,
            19,
            20,
            21,
            22,
            23
        ],
        "calendar": [
            8,
            9,
            10,
            11,
            14,
            15
        ],
        "clock": [
            5,
            6,
            7,
            22,
            23
        ],
        "facebook": [],
        "snapchat": [],
        "whatsapp": [],
        "spotify": [],
        "gm": [
            20,
            21,
            22
        ],
        "maps": [],
        "twitter": []
    },
    "connectivity": {
        "home_timezone": "Asia/Kolkata",
        "home_mcc": "unknown"
    },
    "blacklisted_apps": [
        "bluetooth",
        "gms",
        "org",
        "phone",
        "exchange",
        "stk",
        "service",
        "fmm",
        "stk2"
    ]
}
            
            // --- UI Elements ---
            const scanButton = document.getElementById('optimize-button');
            const hitList = document.getElementById('hit-list');
            const preloadList = document.getElementById('preload-list');
            const preloadText = document.getElementById('preload-text');
            const connectivityText = document.getElementById('connectivity-text');
            const connectivityStatus = document.getElementById('connectivity-status');
            const simulateLocBtn = document.getElementById('simulate-location');
            
            const addAppButton = document.getElementById('add-app-button');
            const runTestButton = document.getElementById('test-button-run');
            const testQueueList = document.getElementById('test-queue-list');
            const liveResultsList = document.getElementById('live-results-list');
            
            const appNameInput = document.getElementById('app-name-input');
            const priorityInput = document.getElementById('priority-input');
            const statusInput = document.getElementById('status-input');
            const levelInput = document.getElementById('level-input');

            let testQueue = [];
            let isSimulatedTravel = false; 

            // --- Helper Functions ---
            function getSimpleAppName(processName) {
                try {
                    if (!processName) return 'unknown';
                    const parts = (processName || "").split('.');
                    if (parts.length > 1) {
                        if (parts[0] === 'com' && parts.length > 2) {
                            if (parts[1] === 'google' && parts[2] === 'android' && parts.length > 3) return parts[3];
                            return parts[1];
                        }
                        return parts[0];
                    } return processName;
                } catch { return 'unknown'; }
            }

            function getAppSolution(app, batteryStatus, batteryLevel) {
                const appName = app.simpleName;
                const appPriority = app.priority;

                if (TRAINED_MODEL.blacklisted_apps.includes(appName)) {
                    return { solution: "Deep Sleep", reason: "Known battery hog (Trained Model)", color: "solution-red" };
                }
                if (['Service', 'Background process'].includes(appPriority) && batteryStatus === 'discharging' && batteryLevel < 30) {
                    return { solution: "CRITICAL: Restrict", reason: Background service on low battery (${batteryLevel}%), color: "solution-red" };
                }
                if (['Service', 'Background process'].includes(appPriority)) {
                    return { solution: "Restrict", reason: "Background service", color: "solution-yellow" };
                }
                if (appPriority === 'Foreground app') {
                    return { solution: "None", reason: "Active user app", color: "solution-green" };
                }
                return { solution: "None", reason: "Low priority", color: "solution-green" };
            }

            // --- Event Listeners ---

            if (scanButton) {
                scanButton.addEventListener('click', () => {
                    if (scanButton.classList.contains('loading')) return;
                    scanButton.classList.add('loading');
                    scanButton.textContent = 'Scanning...';
                    hitList.innerHTML = ''; 
                    setTimeout(() => {
                        BATTERY_DRAIN_APPS.forEach((app, index) => {
                            const li = document.createElement('li');
                            li.className = 'result-item';
                            li.style.animationDelay = ${index * 0.1}s;
                            li.innerHTML = `
                                <div>
                                    <div class="app-name">${app.name}</div>
                                    <div class="app-reason">${app.reason}</div>
                                </div>
                                <span class="action-button">Sleep</span>
                            `;
                            hitList.appendChild(li);
                        });
                        scanButton.classList.remove('loading');
                        scanButton.textContent = 'Scan Complete!';
                    }, 2000); 
                });
            }

            if (addAppButton) {
                addAppButton.addEventListener('click', () => {
                    const selectedOption = appNameInput.options[appNameInput.selectedIndex];
                    const processName = appNameInput.value;
                    const autoPriority = selectedOption.getAttribute('data-priority');
                    
                    const app = {
                        processName: processName,
                        simpleName: getSimpleAppName(processName),
                        displayName: selectedOption.text,
                        priority: autoPriority 
                    };
                    
                    testQueue.push(app); 
                    renderTestQueue(); 
                });
            }
            
            if (runTestButton) {
                runTestButton.addEventListener('click', () => {
                    liveResultsList.innerHTML = ''; 
                    const batteryStatus = statusInput.value;
                    const batteryLevel = parseInt(levelInput.value) || 100;

                    if (testQueue.length === 0) {
                        liveResultsList.innerHTML = <li class="live-result-item"><span class="solution-text solution-yellow">Add an app to the queue first!</span></li>;
                        return;
                    }
                    
                    testQueue.forEach(app => {
                        const result = getAppSolution(app, batteryStatus, batteryLevel);
                        const li = document.createElement('li');
                        li.className = 'live-result-item';
                        li.innerHTML = `
                            <div>
                                <div class="app-name">${app.displayName}</div> 
                                <div class="text-xs text-gray-500">${result.reason}</div>
                            </div>
                            <span class="solution-text ${result.color}">${result.solution}</span>
                        `;
                        liveResultsList.appendChild(li);
                    });
                });
            }

            function renderTestQueue() {
                testQueueList.innerHTML = '';
                testQueue.forEach((app, index) => {
                    const li = document.createElement('li');
                    li.className = 'test-queue-item';
                    li.innerHTML = `
                        <span>${app.displayName}</span>
                        <button data-index="${index}" class="remove-btn">âœ–</button>
                    `;
                    testQueueList.appendChild(li);
                });
            }
            
            testQueueList.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-btn')) {
                    const indexToRemove = parseInt(e.target.dataset.index);
                    testQueue.splice(indexToRemove, 1); 
                    renderTestQueue(); 
                }
            });
            
            if (simulateLocBtn) {
                simulateLocBtn.addEventListener('click', () => {
                    isSimulatedTravel = !isSimulatedTravel; 
                    runConnectivityLogic(); 
                });
            }

            function runResourceAllocation() {
                if (!preloadText || !preloadList) return; 
                preloadList.innerHTML = ''; 
                
                const now = new Date();
                const currentHour = now.getHours(); 
                
                const ampm = currentHour >= 12 ? 'PM' : 'AM';
                const hour12 = currentHour % 12 || 12;
                
                preloadText.textContent = It's ${hour12} ${ampm}. Based on your training data:;
                
                const EXCLUDED_APPS = ['phone', 'whatsapp', 'gmail', 'mail', 'gm'];
                const DISPLAY_APPS = ['youtube', 'instagram', 'chrome', 'calendar', 'clock', 'spotify', 'maps'];
                
                for (const [appName, allowedHours] of Object.entries(TRAINED_MODEL.usage_map)) {
                    if (EXCLUDED_APPS.includes(appName) || !DISPLAY_APPS.includes(appName)) continue;

                    const li = document.createElement('li');
                    li.className = 'result-item';
                    
                    if (allowedHours.includes(currentHour)) {
                        li.innerHTML = `
                            <div>
                                <div class="app-name">${getDisplayName(appName)}</div>
                                <div class="preload-reason">High usage detected at ${hour12}:00</div>
                            </div>
                            <span class="solution-text solution-green">Preload</span>
                        `;
                    } else {
                        li.innerHTML = `
                            <div>
                                <div class="app-name">${getDisplayName(appName)}</div>
                                <div class="hibernate-reason">Low usage at ${hour12}:00</div>
                            </div>
                            <span class="solution-text solution-gray">Hibernate</span>
                        `;
                    }
                    preloadList.appendChild(li);
                }
            }

            function runConnectivityLogic() {
                if (!connectivityText || !connectivityStatus) return; 
                
                const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const homeTimezone = TRAINED_MODEL.connectivity.home_timezone;

                if (userTimezone === homeTimezone && !isSimulatedTravel) {
                    connectivityText.textContent = You are in your home zone (${userTimezone}). Wi-Fi is active.;
                    connectivityStatus.innerHTML = <span class="text-green-700 font-medium">Status: Wi-Fi Active</span>;
                    connectivityStatus.className = "flex items-center p-3 bg-green-50 border border-green-200 rounded-lg";
                } else {
                    const displayZone = isSimulatedTravel ? "VPN/Travel" : userTimezone;
                    connectivityText.textContent = Travel detected (${displayZone}). We've temporarily disabled Wi-Fi scanning to save power.;
                    connectivityStatus.innerHTML = <span class="text-blue-700 font-medium">Status: Wi-Fi Scanning Paused</span>;
                    connectivityStatus.className = "flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg";
                }
            }

            runResourceAllocation();
            runConnectivityLogic();

        });
    </script>
</body>
</html>
